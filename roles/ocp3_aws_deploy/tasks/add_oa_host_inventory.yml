# Source: https://gitlab.sat.engineering.redhat.com/rhci/vm_env/tree/master/openshift/aos-3.11
# Author: Jason Montleon - https://gitlab.sat.engineering.redhat.com/jmontleo

- name: Add openshift ansible inventory
  add_host:
    # Ansible connection
    name: "{{ ec2_instance_ip }}.xip.io"
    groups: "{{ instance_facts[instance_role]['groups'] }}"
    ansible_become: yes
    ansible_user: ec2-user
    ansible_ssh_private_key_file: "{{ ec2_private_key_file }}"

    # AWS provider setup
    openshift_cloudprovider_kind: aws
    openshift_clusterid: "{{ rand_id }}"
    openshift_cloudprovider_aws_access_key: "{{ aws_access_key_id }}"
    openshift_cloudprovider_aws_secret_key: "{{ aws_secret_access_key }}"

    os_sdn_network_plugin_name: 'redhat/openshift-ovs-multitenant'
    ansible_service_broker_install: false
    openshift_deployment_type: origin
    openshift_disable_check: 'disk_availability,memory_availability,docker_storage'
    openshift_public_hostname: "{{ ec2_instance_ip }}.xip.io"
    openshift_public_ip: "{{ ec2_instance_ip }}"
    openshift_master_cluster_public_hostname: "{{ ec2_instance_ip }}.xip.io"
    openshift_master_default_subdomain: "apps.{{ ec2_instance_ip }}.xip.io"
    openshift_master_identity_providers:
      - name: allow_all
        login: true
        challenge: true
        kind: AllowAllPasswordIdentityProvider
    openshift_schedulable: true
    os_update: true
    openshift_release: "{{ ocp_release[ocp_version] }}"
    openshift_portal_net: 172.30.0.0/16
    openshift_image_tag: "{{ ocp_image_tag }}"
    openshift_node_groups:
      - name: 'node-config-master'
        labels:
          - 'node-role.kubernetes.io/master=true'
          - 'node-role.kubernetes.io/infra=true'
      - name: 'node-config-compute'
        labels:
          - 'node-role.kubernetes.io/compute=true'
      - name: 'node-config-all-in-one'
        labels:
          - 'node-role.kubernetes.io/compute=true'
          - 'node-role.kubernetes.io/master=true'
          - 'node-role.kubernetes.io/infra=true'
    openshift_node_group_name: "{{ instance_facts[instance_role]['node_group_tag'] }}"
