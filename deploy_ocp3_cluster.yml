- hosts: localhost
  roles:
    - ocp3_aws_deploy
  vars_files:
    - "{{ playbook_dir }}/config/defaults.yml"

# AWS group is created in previous role
- hosts: aws
  strategy: free
  roles:
    - ocp3_aws_provision
  vars_files:
    - "{{ playbook_dir }}/config/defaults.yml"

- name: Run prerequisites
  import_playbook: "{{ lookup('env', 'WORKSPACE') or '../'}}/openshift-ansible/playbooks/prerequisites.yml"

- name: Run depoyment
  import_playbook: "{{ lookup('env', 'WORKSPACE') or '../'}}/openshift-ansible/playbooks/deploy_cluster.yml"

# Post tasks
- hosts: aws-master
  vars_files:
    - "{{ playbook_dir }}/config/defaults.yml"
  vars:
    post_deploy: true
  roles:
    - ocp3_aws_provision
  become: true
